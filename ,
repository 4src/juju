#!/usr/bin/env bash 
alias ,gp="git commit -am saving; git push; git status"

,jl() {
   f=$1; shift
   julia -O0 --compile=min --startup=no $1.jl $*
}

,md() { 
  gawk ' 
  function trim(s) { sub(/^[ \t\n]*/,"",s); sub(/[ \t\n]*$/,"",s); return s }

  PASS==1 && /^##/ { k=$2">" ; next}
  PASS==1 { CHUNK["<"FILENAME" "k] = CHUNK["<"FILENAME" "k] sep $0 ; sep="\n"}
  PASS==2 { print }
  PASS==2 && /```julia/ {    
        print(trim(CHUNK[$2" "$3]),"\n```")
        USED[$2" "$3]++
        while(getline x >0) if (x ~ /^```/) break } 
  END { for(k in CHUNK)
          if (USED[k] != 1) {
             print("?? used "(USED[k]+0)" time(s) "k)>"/dev/stderr" }}
  ' PASS=1 *.jl PASS=2 $1 > _tmp
 mv _tmp $1
}
